<template>
  <div class="result">
    <h2 v-if="result">{{ result }}</h2>
  </div>
</template>
<script>
import { mapState } from 'vuex'

export default {
  name: 'Result',
  computed: {
    ...mapState([
      'dadataSuggestions',
      'date',
      'fullname'
    ]),
    result(){
      if(this.dadataSuggestions.length && this.date && this.fullname){        
        let { 
          country, 
          region_iso_code, 
          geo_lat, 
          geo_lon 
        } = this.dadataSuggestions[0].data

        country = country.replace('Россия', 'Russia')
        let abbr = this.getAbbr(this.fullname)

        return `${country}/${region_iso_code}/${abbr}/GLAT${geo_lat}-GLON${geo_lon}/${this.date}`
      }
    },
  },
  methods: {
    getAbbr(fullname){      
      let output = ''

      let nameElems = fullname.split(' ')
      nameElems.forEach(el => output += el.charAt(0))
      
      return this.transliterate(output).toUpperCase()
    },
    transliterate(word){
      let a = {"Ё":"YO","Й":"I","Ц":"TS","У":"U","К":"K","Е":"E","Н":"N","Г":"G","Ш":"SH","Щ":"SCH","З":"Z","Х":"H","Ъ":"'","ё":"yo","й":"i","ц":"ts","у":"u","к":"k","е":"e","н":"n","г":"g","ш":"sh","щ":"sch","з":"z","х":"h","ъ":"'","Ф":"F","Ы":"I","В":"V","А":"a","П":"P","Р":"R","О":"O","Л":"L","Д":"D","Ж":"ZH","Э":"E","ф":"f","ы":"i","в":"v","а":"a","п":"p","р":"r","о":"o","л":"l","д":"d","ж":"zh","э":"e","Я":"Ya","Ч":"CH","С":"S","М":"M","И":"I","Т":"T","Ь":"'","Б":"B","Ю":"YU","я":"ya","ч":"ch","с":"s","м":"m","и":"i","т":"t","ь":"'","б":"b","ю":"yu"}

      return word.split('').map((char) => a[char] || char).join("")
    }
  }
}
</script>
<style scoped>
  .result{
    margin: 0 auto;
    width: 50%;
  }
</style>